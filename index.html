<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AccountSDKIOSWeb  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="AccountSDKIOSWeb  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">AccountSDKIOSWeb 4.1.0 Docs</a></p>
        <div class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">AccountSDKIOSWeb Reference</a>
        <img id="carat" src="img/carat.png" alt=""/>
        AccountSDKIOSWeb  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ASWebAuthSessionContextProvider.html">ASWebAuthSessionContextProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AuthenticatedURLSession.html">AuthenticatedURLSession</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Client.html">Client</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Client/AppTransfer.html">â€“ AppTransfer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MulticastDelegate.html">MulticastDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SimplifiedLoginManager.html">SimplifiedLoginManager</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SimplifiedLoginManager/SimplifiedLoginError.html">â€“ SimplifiedLoginError</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/User.html">User</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global%20Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global%20Variables.html#/sdkVersion">sdkVersion</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/HTTPError.html">HTTPError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/IdTokenValidationError.html">IdTokenValidationError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/LoginError.html">LoginError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/LoginStateError.html">LoginStateError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MFAType.html">MFAType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/PreEidType.html">PreEidType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/RefreshTokenError.html">RefreshTokenError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SchibstedAccountLogger.html">SchibstedAccountLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SignatureValidationError.html">SignatureValidationError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent.html">TrackingEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/Screen.html">â€“ Screen</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/Interaction.html">â€“ Interaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/UIElement.html">â€“ UIElement</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/Engagement.html">â€“ Engagement</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/ErrorType.html">â€“ ErrorType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TrackingEvent/AdditionalField.html">â€“ AdditionalField</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Bundle.html">Bundle</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Data.html">Data</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/KeychainStorageError.html">KeychainStorageError</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Result.html">Result</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/UIWindow.html">UIWindow</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/HTTPClient.html">HTTPClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Identifier.html">Identifier</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RetryPolicy.html">RetryPolicy</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TrackingEventsHandler.html">TrackingEventsHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/UserDelegate.html">UserDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/UserProtocol.html">UserProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Account.html">Account</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Address.html">Address</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Address/AddressType.html">â€“ AddressType</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ClientConfiguration.html">ClientConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ClientConfiguration/Environment.html">â€“ Environment</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Email.html">Email</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IdTokenClaims.html">IdTokenClaims</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Name.html">Name</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/OAuthError">OAuthError</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PhoneNumber.html">PhoneNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UserProfileResponse.html">UserProfileResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UserTokens.html">UserTokens</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/HTTPResultHandler">HTTPResultHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/LoginResultHandler">LoginResultHandler</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='schibsted-account-ios-sdk' class='heading'>Schibsted account iOS SDK</h1>

<p><a href="https://github.com/schibsted/account-sdk-ios-web/actions/workflows/ci.yml"><img src="https://github.com/schibsted/account-sdk-ios-web/actions/workflows/ci.yml/badge.svg?branch=master" alt="Build Status"></a>
<img src="https://img.shields.io/github/v/release/schibsted/account-sdk-ios-web" alt="GitHub release (latest by date)">
<img src="https://img.shields.io/badge/Platform-iOS%2012.0%2B-orange.svg?style=flat" alt="Platform">
<a href="https://github.com/schibsted/account-sdk-ios-web/blob/master/LICENSE"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>

<p>New implementation of the Schibsted account iOS SDK using the web flows via 
<a href="https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession"><code>ASWebAuthenticationSession</code></a>.</p>

<p>API documentation can be found <a href="https://schibsted.github.io/account-sdk-ios-web/">here</a>.</p>
<h2 id='getting-started' class='heading'>Getting started</h2>

<p>To implement login with Schibsted account in your app, please first have a look at our
<a href="https://docs.schibsted.io/schibsted-account/gettingstarted/">getting started documentation</a>.
This will help you create a client and configure the necessary data.</p>

<p><strong>Note:</strong> This SDK requires your client to be registered as a <code>public_mobile_client</code> in Self Service (see <a href="https://docs.schibsted.io/schibsted-account/gettingstarted/">getting started documentation</a> for more help).</p>
<h3 id='requirements' class='heading'>Requirements</h3>

<ul>
<li>iOS 12.0+</li>
</ul>
<h3 id='installation' class='heading'>Installation</h3>

<p>Swift Package Manager: <code>.package(url: &quot;https://github.com/schibsted/account-sdk-ios-web&quot;)</code></p>

<p>CocoaPods <code>pod &#39;AccountSDKIOSWeb&#39;</code></p>
<h3 id='usage' class='heading'>Usage</h3>
<h4 id='login-user-and-fetch-profile-data' class='heading'>Login user and fetch profile data</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">clientConfiguration</span> <span class="o">=</span> <span class="kt">ClientConfiguration</span><span class="p">(</span><span class="nv">environment</span><span class="p">:</span> <span class="o">.</span><span class="n">pre</span><span class="p">,</span>
                                              <span class="nv">clientId</span><span class="p">:</span> <span class="n">clientId</span><span class="p">,</span>
                                              <span class="nv">redirectURI</span><span class="p">:</span> <span class="n">redirectURI</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">client</span> <span class="o">=</span> <span class="kt">Client</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">clientConfiguration</span><span class="p">)</span> 
<span class="k">let</span> <span class="nv">contextProvider</span> <span class="o">=</span> <span class="kt">ASWebAuthSessionContextProvider</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">asWebAuthSession</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="nf">getLoginSession</span><span class="p">(</span><span class="nv">contextProvider</span><span class="p">:</span> <span class="n">contextProvider</span><span class="p">,</span> <span class="nv">withSSO</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Success - logged in as </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">user</span><span class="o">.</span><span class="n">fetchProfileData</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">userData</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">userData</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">asWebAuthSession</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre>
<h4 id='get-notified-on-logout' class='heading'>Get notified on logout</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">userDelegate</span><span class="p">:</span> <span class="kt">UserDelegate</span> <span class="o">=</span> <span class="kt">MyUserDelegate</span><span class="p">()</span>
<span class="n">user</span><span class="p">?</span><span class="o">.</span><span class="n">delegates</span><span class="o">.</span><span class="nf">addDelegate</span><span class="p">(</span><span class="n">userDelegate</span><span class="p">)</span>
<span class="k">self</span><span class="o">.</span><span class="n">userDelegate</span> <span class="o">=</span> <span class="n">userDelegate</span> <span class="c1">// Needs to be retained</span>

<span class="kd">class</span> <span class="kt">MyUserDelegate</span><span class="p">:</span> <span class="kt">UserDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">userDidLogout</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Callback will be invoked when user is logged out"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='notes-on-using-custom-uri-schemes' class='heading'>Notes on using custom URI schemes</h3>

<p>When using custom URI as redirect URI, the OS handles opening the app associated with the link instead of triggering the <code>ASWebAuthenticationSession</code> callback.
It results in the <code>ASWebAuthenticationSession</code> view not being closed properly, which instead needs to be done manually:</p>

<ol>
<li><p>Get a reference to <code>ASWebAuthenticationSession</code> and start it:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">handleLoginResult</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">User</span><span class="p">,</span> <span class="kt">LoginError</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Success - logged-in as </span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">uuid</span><span class="se">)</span><span class="s">!"</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">contextProvider</span> <span class="o">=</span> <span class="kt">ASWebAuthSessionContextProvider</span><span class="p">()</span>
<span class="n">asWebAuthSession</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="nf">getLoginSession</span><span class="p">(</span><span class="nv">contextProvider</span><span class="p">:</span> <span class="n">contextProvider</span><span class="p">,</span> <span class="nv">withSSO</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="n">handleLoginResult</span><span class="p">)</span>
<span class="n">asWebAuthSession</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span> <span class="c1">// this will trigger the web context asking the user to login</span>
</code></pre></li>
<li><p>Handle the response as an incoming URL, e.g. via your app&rsquo;s delegate <code>application(_:open:options:)</code>:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span>
                 <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span>
                 <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationOpenURLOptionsKey</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="n">client</span><span class="o">.</span><span class="nf">handleAuthenticationResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="n">asWebAuthSession</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <span class="c1">// manually close the ASWebAuthenticationSession</span>
        <span class="p">}</span>
        <span class="nf">handleLoginResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
<li><p>When implementing <strong>Swedish BankID</strong> authentication the parent app must catch the redirect URI and return with no action. Please make sure that <code>handleAuthenticationResponse</code> is not called for the BankID redirect. The URI scheme that is used to redirect back to the parent app from BankID will have the following format: <code>{app_uri_scheme}:/bankId</code>. Find below a code example:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">handleOnOpenUrl</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">pathComponents</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"bankId"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">client</span><span class="o">.</span><span class="nf">handleAuthenticationResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="n">asWebAuthSession</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <span class="c1">// manually close the ASWebAuthenticationSession</span>
        <span class="p">}</span>
        <span class="nf">handleLoginResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></li>
</ol>
<h3 id='obtaining-tokens-externally' class='heading'>Obtaining tokens externally</h3>

<p>Tokens can be obtained externally and injected into SDK for the already created users. This can be useful in the case of a test scenario.
To do this, first you need to start the web login flow with the request as follow:</p>
<pre class="highlight shell"><code>GET <span class="s2">"</span><span class="k">${</span><span class="nv">BASE_URL</span><span class="k">}</span><span class="s2">/oauth/authorize?client_id=</span><span class="k">${</span><span class="nv">CLIENT_ID</span><span class="k">}</span><span class="s2">&amp;redirect_uri=</span><span class="k">${</span><span class="nv">REDIRECT_URI</span><span class="k">}</span><span class="s2">&amp;response_type=code&amp;scope=openid%20offline_access&amp;state=</span><span class="k">${</span><span class="nv">state</span><span class="k">}</span><span class="s2">&amp;nonce=</span><span class="k">${</span><span class="nv">nonce</span><span class="k">}</span><span class="s2">&amp;code_challenge=</span><span class="k">${</span><span class="nv">CODE_CHALLENGE</span><span class="k">}</span><span class="s2">&amp;code_challenge_method=S256&amp;prompt=select_account"</span>
</code></pre>

<p>where: 
<code>BASE_URL</code> - base URL of Schibsted Account environment
<code>client_id</code> - public mobile client id
<code>redirect_uri</code> - redirect URI for given client
<code>state</code> -  A string value sent by the client that protects end user from CSRF attacks. It&rsquo;s a randomly generated string of 10 characters (both letters and numbers)
<code>nonce</code> - A string value sent by the client that is included in the resulting ID token as a claim. The client must then verify this value to mitigate token replay attacks. It&rsquo;s a randomly generated string of 10 characters (both letters and numbers)
<code>code_challenge</code> - <a href="https://www.oauth.com/oauth2-servers/pkce/"><code>PKCE</code></a> calculated from <code>code_verifier</code></p>

<p>On the finish, web flow returns URL with query parameters <code>state</code> and <code>code</code>. 
Tokens can be obtained with the following request:</p>
<pre class="highlight shell"><code>curl <span class="o">{</span>BASE_URL<span class="o">}</span>/oauth/token <span class="se">\</span>
   <span class="nt">-X</span> POST <span class="se">\</span>
   <span class="nt">-H</span> <span class="s2">"X-OIDC: v1"</span> <span class="se">\</span>
   <span class="nt">-d</span> <span class="s2">"client_id={client_id}"</span> <span class="se">\</span>
   <span class="nt">-d</span> <span class="s2">"grant_type=authorization_code"</span> <span class="se">\</span>
   <span class="nt">-d</span> <span class="s2">"code={code_from_login_flow}"</span> <span class="se">\</span>
   <span class="nt">-d</span> <span class="s2">"code_verifier={code_verifier}"</span> <span class="se">\</span>
   <span class="nt">-d</span> <span class="s2">"redirect_uri={redirect_uri}"</span>
</code></pre>

<p>where <code>code_verifier</code> is the same which was used for calculating <code>code_challenge</code>. It can be a randomly generated string of 60 characters (both letters and numbers)</p>
<h3 id='configuring-logging' class='heading'>Configuring logging</h3>

<p>This SDK uses <a href="https://github.com/apple/swift-log"><code>SwiftLog</code></a>, allowing you to easily customise the logging.
The logger can be modified, for example to change the log level, via the following code:</p>
<pre class="highlight swift"><code><span class="kt">SchibstedAccountLogger</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">logLevel</span> <span class="o">=</span> <span class="o">.</span><span class="n">debug</span>
</code></pre>
<h2 id='how-it-works' class='heading'>How it works</h2>

<p>This SDK implements the <a href="https://tools.ietf.org/html/rfc8252">best practices for user authentication via an OpenID Connect identity provider</a>:</p>

<ul>
<li>It uses <a href="https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession"><code>ASWebAuthenticationSession</code></a>.
This allows for single-sign on between apps, with the user being recognized as a returning user to Schibsted account via cookies.
On iOS 13 and above this behavior can be disabled, which also removes the extra user prompt about allowing to use Schibsted account for login, using
<code>withSSO: false</code> in <code>Client.getLoginSession(withMFA:loginHint:extraScopeValues:withSSO:completion:)</code>.</li>
<li><p>After the completed user authentication, user tokens are obtained and stored securely in the keychain storage.</p>

<ul>
<li>The ID Token is validated according to the <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">specification</a>.
The signature of the ID Token (which is a <a href="https://datatracker.ietf.org/doc/html/rfc7515">JWS</a>) is verified by the library <a href="https://github.com/airsidemobile/JOSESwift"><code>JOSESwift</code></a>.</li>
<li>Authenticated requests to backend services can be done via
<code>AuthenticatedURLSession.dataTask(with: URLRequest, completionHandler: ...</code> 
The SDK will automatically inject the user access token as a Bearer token in the HTTP
Authorization request header.
If the access token is rejected with a <code>401 Unauthorized</code> response (e.g. due to having
expired), the SDK will try to use the refresh token to obtain a new access token and then
retry the request once more.</li>
</ul>

<p><strong>Note:</strong> If the refresh token request fails, due to the refresh token itself having expired
  or been invalidated by the user, the SDK will log the user out.</p></li>
<li><p>Upon opening the app, the last logged-in user can be resumed by the SDK by trying to read previously stored tokens from the keychain storage. This will be handled by once invoking <code>Client.resumeLastLoggedInUser(completion: @escaping (User?) -&gt; Void)</code> upon app start.</p></li>
</ul>
<h2 id='simplified-login' class='heading'>Simplified Login</h2>
<h3 id='configuring-simplified-login' class='heading'>Configuring Simplified Login</h3>

<p>Prerequisite: Applications need to be on the same Apple Development account in order to have access to the shared keychain. </p>

<ol>
<li>In your application target, add Keychain Sharing capability with keychain group set to <code>com.schibsted.simplifiedLogin</code>.</li>
<li>Creating client, pass additional parameter <code>appIdentifierPrefix</code>. It is usually the same as team identifier prefix - 10 characters combination of both numbers and letters assigned by Apple.</li>
</ol>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">client</span> <span class="o">=</span> <span class="kt">Client</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">clientConfiguration</span><span class="p">,</span> <span class="nv">appIdentifierPrefix</span><span class="p">:</span> <span class="s">"xxxxxxxxxx"</span><span class="p">)</span> 
</code></pre>

<ol>
<li>Create <code><a href="Classes/SimplifiedLoginManager.html">SimplifiedLoginManager</a></code> and call <code>getSimplifiedLogin</code> method anytime you want to present SL to user.</li>
</ol>
<pre class="highlight swift"><code>    <span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="kt">ASWebAuthSessionContextProvider</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">SimplifiedLoginManager</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span> <span class="n">client</span><span class="p">,</span> <span class="nv">contextProvider</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span> <span class="nv">env</span><span class="p">:</span> <span class="n">clientConfiguration</span><span class="o">.</span><span class="n">env</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Catch login result </span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">manager</span><span class="o">.</span><span class="nf">requestSimplifiedLogin</span><span class="p">()</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">():</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"success"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Catch error from presenting SL </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>

<p>If you want to present Simplified Login UI on a specific UIWindow, you need to pass the optional parameter <code>window</code> calling <code>requestSimplifiedLogin</code> method.</p>
<h3 id='tracking' class='heading'>Tracking</h3>

<p>The Account SDK does some internal tracking (mostly for the Simplified Login) and allows a <code><a href="Protocols/TrackingEventsHandler.html">TrackingEventsHandler</a></code> to be set during the Client&rsquo;s initialization.
To fulfill this, you can either implement it yourself or use one which is already implemented.</p>

<p><strong>Internal</strong>: There is an internal Schibsted Tracking implementation for the identity SDK available <a href="https://github.schibsted.io/spt-identity/identity-sdk-ios-tracking">here</a> It integrates the latest Account SDK with the latest Pulse Tracking SDK for iOS.</p>
<h4 id='localization' class='heading'>Localization</h4>

<p>Simplified Login comes with the following localization support:</p>

<ol>
<li>ðŸ‡³ðŸ‡´ Norwegian BokmÃ¥l</li>
<li>ðŸ‡¸ðŸ‡ª Swedish</li>
<li>ðŸ‡«ðŸ‡® Finnish</li>
<li>ðŸ‡©ðŸ‡° Danish</li>
<li>ðŸ‡¬ðŸ‡§ English (Default)</li>
</ol>
<h2 id='local-development' class='heading'>Local development</h2>
<h3 id='setup' class='heading'>Setup</h3>
<h4 id='prerequisites' class='heading'>Prerequisites</h4>

<ol>
<li>All you need is Xcode with command-line tools installed. It works perfectly with version 13.4.1.</li>
</ol>
<h4 id='steps' class='heading'>Steps</h4>

<ol>
<li>Clone repository</li>
<li>Open <code>workspace.xcworkspace</code> file, which exists in the Projects folder. It contains two projects inside: AccountSDKIOSWeb which is the SDK itself, and ExampleWeb which serves as a demo application.</li>
<li>To run the demo application on the simulator, choose the ExampleWeb scheme and target your choices like an iPhone or iPad. Run the application with the play button or press <code>command + R</code>.</li>
<li>If Xcode fails to resolve package dependency, click on them and resolve them manually.</li>
</ol>
<h4 id='unit-tests' class='heading'>Unit tests</h4>

<ol>
<li>There are two schemes with tests. To run unit tests, select one of them and press <code>command + U</code></li>
</ol>
<h3 id='how-to-release-the-sdk' class='heading'>How to release the SDK</h3>
<h4 id='prerequisites' class='heading'>Prerequisites</h4>

<ol>
<li>To successfully release the SDK&rsquo;s pod to the CocoaPods repository, you need first set up the pod trunk on your computer. See <a href="https://guides.cocoapods.org/making/getting-setup-with-trunk.html">https://guides.cocoapods.org/making/getting-setup-with-trunk.html</a>.</li>
<li>You should be added as an owner to the library in the CocoaPods repository. Please ask the User Access team, who can give you the correct rights.</li>
</ol>
<h4 id='steps-to-release' class='heading'>Steps to release</h4>

<ol>
<li>Make sure all changes going in the release have been merged to the <code>master</code> branch.</li>
<li>Update new SDK version number in both <a href="https://github.com/schibsted/account-sdk-ios-web/blob/master/Sources/AccountSDKIOSWeb/Lib/Version.swift">Version.swift</a> and <a href="AccountSDKIOSWeb.podspec">AccountSDKIOSWeb.podspec</a> files. Commit this change to the <code>master</code> branch.</li>
<li>Create a new <a href="https://github.com/schibsted/account-sdk-ios/releases">release via GitHub</a>.

<ol>
<li>Enter the version number as the tag name, and include all important changes in the release description.</li>
</ol></li>
<li>Publish the pod by running <code>pod trunk push AccountSDKIOSWeb.podspec</code> from your local machine.</li>
</ol>

          </section>
        </section>
        <section id="footer">
          <p>Â© 2021 Schibsted Products &amp; Technology</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy â™ªâ™« v0.14.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
